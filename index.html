<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Entre Potes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* (Styles CSS identiques √† ta version actuelle ‚Äî non modifi√©s) */
    /* ... */
  </style>
</head>
<body>
  <h1 id="titre"></h1>
  <p><em id="sousTitre"></em></p>

  <h2 id="quizQuestion">Chargement‚Ä¶</h2>
  <div id="quizAnswers"></div>
  <button id="nextBtn" onclick="nextQuestion()" style="display: none;">Suivant</button>
  <div id="result"></div>
  <button id="restartBtn" onclick="restartQuiz()" style="display: none;">Rejouer</button>

  <footer>
    <button id="toggleThemeBtn" onclick="toggleTheme()">Basculer le th√®me</button>
    <div>rev.0.13</div>
  </footer>

  <script>
    const noms = ["Thomas", "Simon", "Vladimir", "Alexis", "Ludovic", "Sacha", "Maxence", "Le zinc"];
    const questionsURL = "https://virnichka.github.io/Pirates/questions.json";
    const accrochesURL = "https://virnichka.github.io/Pirates/accroches.json";

    let questions = [];
    let shuffledQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;

    let titres = [];
    let sousTitres = [];

    async function chargerAccroches() {
      try {
        const response = await fetch(accrochesURL);
        const data = await response.json();
        titres = data.titres;
        sousTitres = data.sousTitres;
        afficherAccroches();
      } catch (e) {
        console.error("Erreur de chargement des accroches", e);
      }
    }

    function afficherAccroches() {
      const titre = titres[Math.floor(Math.random() * titres.length)];
      const sousTitre = sousTitres[Math.floor(Math.random() * sousTitres.length)];
      document.getElementById("titre").innerText = titre;
      document.getElementById("sousTitre").innerText = sousTitre;
    }

    async function chargerQuestions() {
      try {
        const response = await fetch(questionsURL);
        const data = await response.json();
        questions = data;
        shuffledQuestions = questions.sort(() => Math.random() - 0.5);
        showQuestion();
      } catch (error) {
        document.getElementById("quizQuestion").innerText = "Erreur de chargement du quiz.";
      }
    }

    function getRandomNames(exclude) {
      const autres = noms.filter(n => n !== exclude);
      return autres.sort(() => Math.random() - 0.5).slice(0, 3);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function showQuestion() {
      const current = shuffledQuestions[currentQuestionIndex];
      document.getElementById("quizQuestion").innerText = current.question;

      const shuffledAnswers = shuffle([
        current.correct,
        ...getRandomNames(current.correct)
      ]);

      const answersContainer = document.getElementById("quizAnswers");
      answersContainer.innerHTML = "";

      shuffledAnswers.forEach(answer => {
        const button = document.createElement("button");
        button.innerText = answer;
        button.className = "answerBtn";
        button.onclick = () => checkAnswer(answer, current.correct);
        answersContainer.appendChild(button);
      });

      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("restartBtn").style.display = "none";
    }

    function checkAnswer(selected, correct) {
      const buttons = document.querySelectorAll(".answerBtn");
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.innerText === correct) {
          btn.classList.add("correct");
        } else if (btn.innerText === selected) {
          btn.classList.add("incorrect");
        }
      });

      if (selected === correct) {
        score++;
      }

      document.getElementById("nextBtn").style.display = "block";
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < shuffledQuestions.length) {
        showQuestion();
      } else {
        showFinalScore();
      }
    }

    function showFinalScore() {
      const commentaires = [
        "Z√©ro point√©. T'es s√ªr que tu fais partie du groupe ? üòÖ",
        "Une seule bonne r√©ponse‚Ä¶ √áa sent le d√©ni ou l'amn√©sie s√©lective.",
        "Deux bonnes r√©ponses. Tu veux qu'on te rafra√Æchisse la m√©moire ?",
        "Trois ? Tu connais juste les potins les plus √©vidents.",
        "Quatre. Tu sauves l'honneur‚Ä¶ de justesse.",
        "Cinq bonnes r√©ponses ! Pas mal, t'as bien suivi les histoires.",
        "Six ? On sent que t'as pris des notes dans l‚Äôombre.",
        "Sept ? T'es clairement une comm√®re premium.",
        "Huit sur huit ? Tu ES la honte collective incarn√©e."
      ];

      const commentaire = commentaires[score] || "Bravo‚Ä¶ ou d√©sol√©, on sait plus trop.";
      document.getElementById("quizQuestion").innerText = "Quiz termin√© !";
      document.getElementById("quizAnswers").innerHTML = `
        <p>Tu as eu ${score} bonne(s) r√©ponse(s) sur ${shuffledQuestions.length}.</p>
        <p>${commentaire}</p>
        <p><label for="playerName">Ton pr√©nom :</label><br>
        <input type="text" id="playerName" placeholder="Ton blaze ici"></p>
        <button onclick="soumettreScore()">Envoyer mon score</button>
      `;
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("restartBtn").style.display = "block";
    }

    function soumettreScore() {
      const nom = document.getElementById("playerName").value.trim() || "Anonyme";
      envoyerResultat(nom, score, shuffledQuestions.length);
      document.getElementById("quizAnswers").innerHTML += "<p>‚úÖ Score envoy√© !</p>";
    }

    function envoyerResultat(nom, score, total) {
      fetch("https://script.google.com/macros/s/TON_URL_SCRIPT/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nom: nom,
          score: score,
          total: total
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log("‚úÖ Score envoy√© :", data);
      })
      .catch(error => {
        console.error("‚ùå Erreur lors de l'envoi du score :", error);
      });
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      shuffledQuestions = questions.sort(() => Math.random() - 0.5);
      showQuestion();
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
      const btn = document.getElementById("toggleThemeBtn");
      btn.innerText = document.body.classList.contains("light")
        ? "Basculer en th√®me sombre"
        : "Basculer en th√®me clair";
    }

    window.onload = () => {
      chargerAccroches();
      chargerQuestions();
    };
  </script>
</body>
</html>
