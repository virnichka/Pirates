<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Entre Potes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-color: #121212;
      --text-color: #f0f0f0;
      --btn-bg: #1f1f1f;
      --btn-text: #fff;
      --btn-border: #333;
      --correct: #2e7d32;
      --incorrect: #c62828;
      --primary: #1976d2;
      --primary-hover: #1565c0;
    }

    body.light {
      --bg-color: #ffffff;
      --text-color: #000000;
      --btn-bg: #eeeeee;
      --btn-text: #000000;
      --btn-border: #cccccc;
      --correct: #4caf50;
      --incorrect: #f44336;
      --primary: #0d47a1;
      --primary-hover: #08306b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      max-width: 100vw;
      overflow-x: hidden;
    }

    h1 {
      font-size: 1.8em;
      margin-bottom: 10px;
    }

    #quizQuestion {
      font-size: 1.3em;
      margin: 20px auto;
      max-width: 90%;
      line-height: 1.5;
      word-break: break-word;
    }

    #quizAnswers {
      margin-top: 20px;
    }

    #quizAnswers button {
      display: block;
      margin: 10px auto;
      padding: 12px 24px;
      font-size: 16px;
      width: 80%;
      max-width: 300px;
      border-radius: 6px;
      background-color: var(--btn-bg);
      color: var(--btn-text);
      border: 2px solid var(--btn-border);
      transition: all 0.2s ease-in-out;
    }

    #quizAnswers button:hover {
      background-color: var(--btn-border);
      transform: scale(1.02);
    }

    #quizAnswers button:active {
      transform: scale(0.98);
    }

    #quizAnswers button.correct {
      background-color: var(--correct) !important;
      color: white;
      border: none;
    }

    #quizAnswers button.incorrect {
      background-color: var(--incorrect) !important;
      color: white;
      border: none;
    }

    #nextBtn, #restartBtn, #toggleThemeBtn {
      margin: 20px auto 10px;
      padding: 10px 20px;
      font-size: 16px;
      display: block;
      border-radius: 6px;
      max-width: 300px;
      background-color: var(--primary);
      color: white;
      border: none;
      transition: all 0.2s ease-in-out;
    }

    #nextBtn:hover, #restartBtn:hover, #toggleThemeBtn:hover {
      background-color: var(--primary-hover);
      transform: scale(1.03);
    }

    #result {
      margin-top: 20px;
      font-size: 1.2em;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
    }

    footer {
      margin-top: 50px;
      font-size: 0.8em;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }

      #quizQuestion {
        font-size: 1.1em;
      }

      #quizAnswers button {
        font-size: 15px;
        padding: 10px;
      }

      #nextBtn, #restartBtn {
        font-size: 15px;
        padding: 10px 18px;
      }
    }
  </style>
</head>
<body>
  <h1 id="titre"></h1>
  <p><em id="sousTitre"></em></p>

  <h2 id="quizQuestion">Chargement‚Ä¶</h2>
  <div id="quizAnswers"></div>
  <button id="nextBtn" onclick="nextQuestion()" style="display: none;">Suivant</button>
  <div id="result"></div>
  <button id="restartBtn" onclick="restartQuiz()" style="display: none;">Rejouer</button>

  <footer>
    <button id="toggleThemeBtn" onclick="toggleTheme()">Basculer le th√®me</button>
    <div>rev.0.14</div>
  </footer>

  <script>
    const noms = ["Thomas", "Simon", "Vladimir", "Alexis", "Ludovic", "Sacha", "Maxence", "Le zinc"];
    const questionsURL = "https://virnichka.github.io/Pirates/questions.json";
    const accrochesURL = "https://virnichka.github.io/Pirates/accroches.json";

    let questions = [];
    let shuffledQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;

    let titres = [];
    let sousTitres = [];

    async function chargerAccroches() {
      try {
        const response = await fetch(accrochesURL);
        const data = await response.json();
        titres = data.titres;
        sousTitres = data.sousTitres;
        afficherAccroches();
      } catch (e) {
        console.error("Erreur de chargement des accroches", e);
      }
    }

    function afficherAccroches() {
      const titre = titres[Math.floor(Math.random() * titres.length)];
      const sousTitre = sousTitres[Math.floor(Math.random() * sousTitres.length)];
      document.getElementById("titre").innerText = titre;
      document.getElementById("sousTitre").innerText = sousTitre;
    }

    async function chargerQuestions() {
      try {
        const response = await fetch(questionsURL);
        const data = await response.json();
        questions = data;
        shuffledQuestions = questions.sort(() => Math.random() - 0.5);
        showQuestion();
      } catch (error) {
        document.getElementById("quizQuestion").innerText = "Erreur de chargement du quiz.";
      }
    }

    function getRandomNames(exclude) {
      const autres = noms.filter(n => n !== exclude);
      return autres.sort(() => Math.random() - 0.5).slice(0, 3);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function showQuestion() {
      const current = shuffledQuestions[currentQuestionIndex];
      document.getElementById("quizQuestion").innerText = current.question;

      const shuffledAnswers = shuffle([
        current.correct,
        ...getRandomNames(current.correct)
      ]);

      const answersContainer = document.getElementById("quizAnswers");
      answersContainer.innerHTML = "";

      shuffledAnswers.forEach(answer => {
        const button = document.createElement("button");
        button.innerText = answer;
        button.className = "answerBtn";
        button.onclick = () => checkAnswer(answer, current.correct);
        answersContainer.appendChild(button);
      });

      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("restartBtn").style.display = "none";
    }

    function checkAnswer(selected, correct) {
      const buttons = document.querySelectorAll(".answerBtn");
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.innerText === correct) {
          btn.classList.add("correct");
        } else if (btn.innerText === selected) {
          btn.classList.add("incorrect");
        }
      });

      if (selected === correct) {
        score++;
      }

      document.getElementById("nextBtn").style.display = "block";
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < shuffledQuestions.length) {
        showQuestion();
      } else {
        showFinalScore();
      }
    }

    function showFinalScore() {
      const commentaires = [
        "Z√©ro point√©. T'es s√ªr que tu fais partie du groupe ? üòÖ",
        "Une seule bonne r√©ponse‚Ä¶ √áa sent le d√©ni ou l'amn√©sie s√©lective.",
        "Deux bonnes r√©ponses. Tu veux qu'on te rafra√Æchisse la m√©moire ?",
        "Trois ? Tu connais juste les potins les plus √©vidents.",
        "Quatre. Tu sauves l'honneur‚Ä¶ de justesse.",
        "Cinq bonnes r√©ponses ! Pas mal, t'as bien suivi les histoires.",
        "Six ? On sent que t'as pris des notes dans l‚Äôombre.",
        "Sept ? T'es clairement une comm√®re premium.",
        "Huit sur huit ? Tu ES la honte collective incarn√©e."
      ];

      const commentaire = commentaires[score] || "Bravo‚Ä¶ ou d√©sol√©, on sait plus trop.";
      document.getElementById("quizQuestion").innerText = "Quiz termin√© !";
      document.getElementById("quizAnswers").innerHTML = `
        <p>Tu as eu ${score} bonne(s) r√©ponse(s) sur ${shuffledQuestions.length}.</p>
        <p>${commentaire}</p>
        <p><label for="playerName">Ton pr√©nom :</label><br>
        <input type="text" id="playerName" placeholder="Ton blaze ici"></p>
        <button onclick="soumettreScore()">Envoyer mon score</button>
      `;
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("restartBtn").style.display = "block";
    }

    function soumettreScore() {
      const nom = document.getElementById("playerName").value.trim() || "Anonyme";
      envoyerResultat(nom, score, shuffledQuestions.length);
      document.getElementById("quizAnswers").innerHTML += "<p>‚úÖ Score envoy√© !</p>";
    }

    function envoyerResultat(nom, score, total) {
      fetch("https://script.google.com/macros/s/TON_URL_SCRIPT/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nom: nom,
          score: score,
          total: total
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log("‚úÖ Score envoy√© :", data);
      })
      .catch(error => {
        console.error("‚ùå Erreur lors de l'envoi du score :", error);
      });
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      shuffledQuestions = questions.sort(() => Math.random() - 0.5);
      showQuestion();
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
      const isLight = document.body.classList.contains("light");
      const btn = document.getElementById("toggleThemeBtn");
      btn.innerText = isLight ? "Basculer en th√®me sombre" : "Basculer en th√®me clair";
    }

    window.onload = () => {
      chargerAccroches();
      chargerQuestions();
      toggleTheme(); // Pour init texte bouton
      toggleTheme(); // Pour garder th√®me par d√©faut
    };
  </script>
</body>
</html>
