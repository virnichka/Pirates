<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwBFb6KKtgUUlKaxESDnN__J9eei9OHOS0FsTvGYbNxnrPkNSUP09SmPGCpwIOw5u_h/exec";

let questions = [];
let shuffledQuestions = [];
let currentQuestionIndex = 0;
let score = 0;

// Charger les questions depuis Google Sheets
async function chargerQuestions() {
  try {
    const response = await fetch(scriptURL);
    const data = await response.json();

    // M√©lange des questions
    questions = data;
    shuffledQuestions = questions.sort(() => Math.random() - 0.5);
    showQuestion();
  } catch (error) {
    console.error("Erreur de chargement des questions :", error);
    document.getElementById("quizQuestion").innerText = "Erreur de chargement du quiz.";
  }
}

// Afficher une question
function showQuestion() {
  const currentQuestion = shuffledQuestions[currentQuestionIndex];
  document.getElementById("quizQuestion").innerText = currentQuestion.question;

  const shuffledAnswers = shuffle([
    currentQuestion.correct,
    ...getRandomNames(currentQuestion.correct)
  ]);

  const answersContainer = document.getElementById("quizAnswers");
  answersContainer.innerHTML = "";

  shuffledAnswers.forEach(answer => {
    const button = document.createElement("button");
    button.innerText = answer;
    button.className = "answerBtn";
    button.onclick = () => checkAnswer(answer, currentQuestion.correct);
    answersContainer.appendChild(button);
  });

  document.getElementById("nextBtn").style.display = "none";
}

// V√©rifier la r√©ponse
function checkAnswer(selected, correct) {
  const buttons = document.querySelectorAll(".answerBtn");
  buttons.forEach(btn => {
    btn.disabled = true;
    if (btn.innerText === correct) {
      btn.style.backgroundColor = "#4CAF50";
    } else if (btn.innerText === selected) {
      btn.style.backgroundColor = "#f44336";
    }
  });

  if (selected === correct) {
    score++;
  }

  document.getElementById("nextBtn").style.display = "inline-block";
}

// Aller √† la question suivante
function nextQuestion() {
  currentQuestionIndex++;
  if (currentQuestionIndex < shuffledQuestions.length) {
    showQuestion();
  } else {
    showResult();
  }
}

// Afficher le r√©sultat final
function showResult() {
  document.getElementById("quizQuestion").style.display = "none";
  document.getElementById("quizAnswers").style.display = "none";
  document.getElementById("nextBtn").style.display = "none";

  const pseudo = prompt("Entre ton pr√©nom ou pseudo (facultatif) :") || "Anonyme";
  envoyerResultat(pseudo, score, shuffledQuestions.length);

  document.getElementById("result").innerHTML = `
    <p>Tu as obtenu <strong>${score} / ${shuffledQuestions.length}</strong></p>
    <p>${getMessage(score)}</p>
  `;
}

// Envoyer le score vers Google Sheets
function envoyerResultat(nom, score, total) {
  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nom, score, total })
  })
  .then(res => res.json())
  .then(data => {
    console.log("‚úÖ Score envoy√© :", data);
  })
  .catch(err => {
    console.error("‚ùå Erreur d‚Äôenvoi du score :", err);
  });
}

// M√©langer un tableau
function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

// Simuler des faux noms pour les mauvaises r√©ponses
function getRandomNames(correctName) {
  const allNames = ["Thomas", "Simon", "Vladimir", "Alexis", "Ludovic", "Sacha", "Maxence", "Le zinc"];
  const others = allNames.filter(name => name !== correctName);
  const shuffled = shuffle(others);
  return shuffled.slice(0, 3); // 3 r√©ponses leurres
}

// Message final personnalis√©
function getMessage(score) {
  if (score === 0) return "T‚Äôas dormi ou quoi ?";
  if (score < 3) return "Pas ouf‚Ä¶";
  if (score < 6) return "Correct mais pas glorieux.";
  return "Tu connais trop bien la bande, psychopathe üòé";
}

// Initialisation
window.onload = chargerQuestions;
</script>
